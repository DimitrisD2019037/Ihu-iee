#include <main.h>
#byte PORTB=0xF81
#byte PORTD=0xF83  
                                                            
// ????s? t?? ???t??a? d?a??p?? ap? t??? a???d??te? RB4, RB5, RB6, RB7
void rb(void) ;  
void init(void);

//Global µetaß??t? ??a ?a ??at?s??µe t?? te?e?ta?a t?µ? t?? p??ta? ?
int8 lastPORTB;      

void main(){  
   // ???t??a a?????p???s??, ???µ?se?? e?s?d??/e??d??, d?a??p?? ??p.
   init();  
   // t? ????? p????aµµa de? ???e? t?p?ta
   while(TRUE){;}
}        


void init (void){
   set_tris_d(0x00);           //  ?a????sµ?? t?? p??ta? D ?? e??d??
   enable_interrupts(GLOBAL);  //??e???p???s? t?? ?e????? d?a??pt?  d?a??p??
   enable_interrupts(INT_RB);  //??e???p???s? d?a??p?? ap? a??a?? 
   set_tris_b(0xff);                   //?at?stas?? st??? a???d??te?
   set_tris_d(0x00);                         // RB4, RB5, RB6, RB7
   PORTD=0x00;
   lastPORTB=PORTB;       
}                           



#INT_RB         // ??a??p? p?? p???a?e?ta? ap? a??a??
                // ?at?stas?? st??? a???d??te? RB4, RB5, RB6, RB7
void rb (void){ // ???? t?? ???t??a? e??p???t?s?? t?? d?a??p?? rb
   int8 changes;                    // ???sµ?? µetaß??t?? t?? 8 bit.
   changes = lastPORTB ^ PORTB;     // G??eta? 1 t? bit p?? ???a?e
   //?µfa???eta? sa? 1 st? µetaß??t? changes t? bit p?? ???a?e.
   // ?etaf??eta? ? ??a t?µ? t?? ???ta? ?
   //St?? t?µ? t?? µetaß??t?? lastPORTB
   lastPORTB=PORTB;
   PORTD=changes;
   //?a??st???s? ??a ap?f??? a?ap?d?se??
   delay_ms (100);                   
}   